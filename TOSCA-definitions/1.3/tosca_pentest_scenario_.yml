tosca_definitions_version: tosca_simple_yaml_1_3
namespace: pentest_scenario

description: TOSCA Pentest scenario template for deploying two servers with specific OS, web applications, and associated vulnerabilities.

metadata:
  template_name: Pentest_Scenario
  template_author: Michele Cerreta
  template_version: 1.0.10

data_types:
  pentest_scenario.vulnerability_info:
    properties:
      CVE:
        type: string
      description:
        type: string
      severity_score:
        type: float
  pentest_scenario.os_info:
    properties:
      type:
        type: string
      distribution:
        type: string
      version:
        type: string
  pentest_scenario.network_info:
    properties:
      name:
        type: string
      ip:
        type: string

capability_types:
  pentest_scenario.capability.vulnerable:
    derived_from: tosca.capabilities.Root
    description: A capability type indicating that an application can have vulnerabilities.

relationship_types:
  pentest_scenario.relationships.HasVulnerability:
    derived_from: tosca.relationships.DependsOn
    description: Represents a relationship where an application has associated vulnerabilities.
    valid_target_types: 
     - pentest_scenario.capability.vulnerable
node_types:
  pentest_scenario.application:
    derived_from: tosca.nodes.WebApplication
    properties:
      name:
        type: string
      version:
        type: string
    requirements:
      - host:
         capability: tosca.capabilities.Compute
         node: pentest_scenario.custom_compute
         relationship: tosca.relationships.HostedOn
    capabilities:
      vulnerable:
        type: pentest_scenario.capability.vulnerable
          
  pentest_scenario.custom_compute:
    derived_from: tosca.nodes.Compute
    properties:
      os:
        type: pentest_scenario.os_info
      network:
        type: pentest_scenario.network_info
      applications:
        type: list
    capabilities:
      host:
      type: tosca.capabilities.Compute 

  pentest_scenario.vulnerability:
    properties:
      info:
        type: pentest_scenario.vulnerability_info
    requirements:
      - host:
          relationship: pentest_scenario.relationships.HasVulnerability

topology_template:
  node_templates:
    elfinder_vulnerability:
      type: pentest_scenario.vulnerability
      properties:
        info:
          CVE: "CVE-2021-32682"
          description: "A vulnerability in elFinder 2.1.47"
          severity_score: 9.8
      requirements:
        - host:
            node: elfinder
            relationship: pentest_scenario.relationships.HasVulnerability

    grafana_vulnerability:
      type: pentest_scenario.vulnerability
      properties:
        info:
          CVE: "CVE-2021-43798"
          description: "A vulnerability in Grafana Server 8.26"
          severity_score: 7.5
      requirements:
        - host:
            node: grafana_server
            relationship: pentest_scenario.relationships.HasVulnerability
          
    grafana_server:
      type: pentest_scenario.application
      properties:
        name: "Grafana Server"
        version: "2.3.4"
      requirements:
        - host:
            node: intranet_server
            relationship: tosca.relationships.HostedOn
            
    elfinder:
      type: pentest_scenario.application
      properties:
        name: "ElFinder"
        version: "2.1.47"
      requirements:
        - host:
            node: dmz_server
            relationship: tosca.relationships.HostedOn

    dmz_server:
      type: pentest_scenario.custom_compute
      properties:
        os:
          type: linux
          distribution: ubuntu
          version: '20.04'
        network:
          name: dmz_network
          ip: '10.0.2.2'

    intranet_server:
      type: pentest_scenario.custom_compute
      properties:
        os:
          type: linux
          distribution: debian
          version: '10'
        network:
          name: intranet_network
          ip: 10.0.1.1

    dmz_network:
      type: tosca.nodes.network.Network
      properties:
        cidr: "10.0.2.0/24"

    intranet_network:
      type: tosca.nodes.network.Network
      properties:
        cidr: "10.0.1.0/24"
